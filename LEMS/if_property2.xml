<?xml version="1.0" ?>
<Lems xmlns="http://www.neuroml.org/lems/0.7.3" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.neuroml.org/lems/0.7.3 https://raw.githubusercontent.com/LEMS/LEMS/development/Schemas/LEMS/LEMS_v0.7.3.xsd">

    <Include file="Cells.xml"/>
    <Include file="Networks.xml"/>
    <Include file="Simulation.xml"/>
    <Include file="LEMSUnitsConstants.xml"/>
  
    <ComponentType name="neuron1" extends="baseCellMembPot">
      
        <Property dimension="voltage" name="v0"/>
        <Property dimension="time" name="tau"/>
    
        <!--  Not required if baseCellMembPot
        <EventPort direction="out" name="spike"/>
        <Exposure dimension="voltage" name="v"/>  -->
    
        <Dynamics>
        
            <StateVariable dimension="voltage" exposure="v" name="v"/>
      
            <OnStart>
                <StateAssignment value="0" variable="v"/>
            </OnStart>
     
            <Regime name="refractory">
                <StateVariable dimension="time" name="lastspike"/>
                <OnEntry>
                    <StateAssignment value="t" variable="lastspike"/>
                </OnEntry>
                <OnCondition test="t .gt. ( lastspike + 15.*ms )">
                    <Transition regime="integrating"/>
                </OnCondition>
            </Regime>
      
            <Regime initial="true" name="integrating">
                <TimeDerivative value="(v0 - v) / tau" variable="v"/>
                <OnCondition test="v .gt. (10 * mV)">
                    <EventOut port="spike"/>
                    <StateAssignment value="0*mV" variable="v"/>
                    <Transition regime="refractory"/>
                </OnCondition>
            </Regime>
      
        </Dynamics>
    </ComponentType>
  
  

    <ComponentType name="lifneurons" extends="basePopulation">
        <Constant name="MV" symbol="MV" dimension="voltage" value="1 mV"/>
        <Parameter dimension="none" name="n"/>
        <Parameter dimension="time" name="tau_p"/>
        
        <!-- Required for basePopulation but not used -->
        <ComponentReference name="component" type="baseCell"/>
        
        <Structure>
            <MultiInstantiate componentType="neuron1" number="n">
                <Assign property="v0" value="20*MV * index / (n-1)"/>
                <Assign property="tau" value="tau_p"/>
            </MultiInstantiate>
        </Structure>
    </ComponentType>
 
  
  
    <network id="net1">
        <lifneurons id="lifPop" n="7" tau_p="10. ms"/>
    </network>
  

    <Simulation id="sim1" length=".5s" step="0.01ms" target="net1">
      
        <Display id="d0" title="example trace" timeScale="1ms" xmin="-50" xmax="550" ymin="-1" ymax="11">
            <Line id="exampleVoltage5" quantity="lifPop[5]/v" scale="1mV" timeScale="1ms" color="#882228"/>
            <Line id="exampleVoltage6" quantity="lifPop[6]/v" scale="1mV" timeScale="1ms" color="#000028"/>
        </Display>

        <OutputFile id="spikes" fileName="record_property.dat">
            <OutputColumn id="i0" quantity="lifPop[5]/v" />
            <OutputColumn id="i1" quantity="lifPop[6]/v" />
        </OutputFile>

        <EventOutputFile id="iaf_spikes" fileName="record_property.spikes" format="TIME_ID">
            <EventSelection id="0" select="lifPop[0]" eventPort="spike"/>
            <EventSelection id="1" select="lifPop[1]" eventPort="spike"/>
            <EventSelection id="2" select="lifPop[2]" eventPort="spike"/>
            <EventSelection id="3" select="lifPop[3]" eventPort="spike"/>
            <EventSelection id="4" select="lifPop[4]" eventPort="spike"/>
            <EventSelection id="5" select="lifPop[5]" eventPort="spike"/>
            <EventSelection id="6" select="lifPop[6]" eventPort="spike"/>
        </EventOutputFile>

    </Simulation>
  
    <Target component="sim1" />
</Lems>

